<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>backwater</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<h1>backwater</h1>


<p>[![Build Status](https://travis-ci.org/g-andrade/backwater.png?branch=master)](https://travis-ci.org/g-andrade/backwater)</p>

<p>Backwater is an no-frills RPC framework for remote Erlang and Elixir modules,
built on top of <a href="https://github.com/ninenines/cowboy">cowboy</a> and
<a href="https://github.com/benoitc/hackney">hackney</a>.</p>

<p>* Arbitrary modules can be wholly or partially exposed
* Which functions to expose/export can be specified using custom attributes (default behaviour)
* Module-specific wrappers for remote calls can be generated using a bundled rebar3 plugin (Erlang only)
* Arguments and return values are encoded using <a href="http://erlang.org/doc/apps/erts/erl_ext_dist">External Term Format</a>; unsafe arguments and return values are not decoded by default
* Multiple instances of both client and server can be launched and managed independently
* Remote exceptions are returned as errors but can be locally rethrown if so desired
* (Purged) stacktraces of remote exceptions are returned by default
* All calls and responses are authenticated and signed using a modified version of <a href="https://tools.ietf.org/id/draft-cavage-http-signatures-07.txt">HTTP signatures</a>; nevertheless, it's <b>strongly</b> recommended to use HTTPS, as this doesn't protect against replay attacks (besides the potential exposure of sensitive data)</p>

<p>Requirements:
* Erlang/OTP 19 and up</p>

<p>The server start/stop interface is very similar to cowboy's, and all cowboy settings, excluding routing, are available for tweaking.</p>

<p>The client interface is made up of start/stop calls for management and an apply/3-esque function; hackney settings can be arbitrarily tweaked or overridden.</p>

<p>The rebar3 code generation plugin is still not as polished as it could be but it works fairly well.</p>

<p>Some simple examples are under 'examples/'; for all possible configuration options, check the <a href="#modules">documentation</a>.</p>

<h3><a name="Example_1_-_Remote_'string'_module_and_client_code_generation_(Erlang)">Example 1 - Remote 'string' module and client code generation (Erlang)</a></h3>

<h4><a name="1.1._Configure_dependencies_and_the_rebar3_plugin">1.1. Configure dependencies and the rebar3 plugin</a></h4>
<pre lang="erlang">
% rebar.config
{backwater_gen,
 [{client_ref, example1},
  {target, {stdlib, string, [{exports,all}]}}]}.

{deps, [{backwater, "1.0.0"}]}.
{plugins, [{backwater, "1.0.0"}]}.
</pre>

<h4><a name="1.2._Generate_the_wrapper_code">1.2. Generate the wrapper code</a></h4>
<pre>
$ rebar3 backwater generate
# "src/rpc/rpc_string.erl" will be created
</pre>

<h4><a name="1.3._Generate_unique_secret">1.3. Generate unique secret</a></h4>
<pre lang="erlang">
Secret = crypto:strong_rand_bytes(32).
</pre>

<h4><a name="1.4._Start_server">1.4. Start server</a></h4>
<pre lang="erlang">
% Place this where appropriate e.g. on application start/2 callback
{ok, _Pid} =
    backwater_server:start_clear(
        example1,
        #{ secret =&gt; Secret,
           exposed_modules =&gt; [{string, [{exports,all}]] },
        [{port, 8080}],
        #{}).
</pre>

<h4><a name="1.5._Start_client">1.5. Start client</a></h4>
<pre lang="erlang">
% Place this where appropriate e.g. on application start/2 callback
ok = backwater_client:start(
        example1,
        #{ endpoint =&gt; &lt;&lt;"http://127.0.0.1:8080/"&gt;&gt;,
           secret =&gt; Secret }).
</pre>

<h4><a name="1.6._Execute_remote_calls_using_the_generated_code">1.6. Execute remote calls using the generated code</a></h4>
<pre lang="erlang">
{ok, 5} = rpc_string:length("hello"),
{ok, {3.14, ""}} = rpc_string:to_float("3.14").
</pre>

<h3><a name="Example_2_-_A_remote_simple_calculator_using_Kernel_functions_(Elixir)">Example 2 - A remote simple calculator using Kernel functions (Elixir)</a></h3>

<h4><a name="2.1._Add_backwater_dependency_to_Mix">2.1. Add backwater dependency to Mix</a></h4>
<pre lang="elixir">
#mix.exs
# [...]
  defp deps do
    [{:backwater, "-&gt; 1.0"}]
  end
# [...]
</pre>

<h4><a name="2.2._Generate_unique_secret">2.2. Generate unique secret</a></h4>
<pre lang="elixir">
secret = :crypto.strong_rand_bytes(32)
</pre>

<h4><a name="2.3._Start_server">2.3. Start server</a></h4>
<pre lang="elixir">
{:ok, _pid} =
    :backwater_server.start_clear(
        :example2,
        %{ :secret =&gt; secret,
           :exposed_modules =&gt; [{Kernel, [{:exports, [:+, :-, :*, :/]}]}] },
        [{:port, 8080}],
        %{})
</pre>

<h4><a name="2.4_Start_client">2.4 Start client</a></h4>
<pre lang="elixir">
:ok = backwater_client.start(
        :example2,
        %{ :endpoint =&gt; "http://127.0.0.1:8080/",
           :secret =&gt; secret })
</pre>

<h4><a name="2.5_Execute_remote_calls">2.5 Execute remote calls</a></h4>
<pre lang="elixir">
{:ok, 5}   = :backwater_client.call(:example2, :+, [3, 2])
{:ok, 1}   = :backwater_client.call(:example2, :-, [3, 2])
{:ok, 6}   = :backwater_client.call(:example2, :*, [3, 2])
{:ok, 1.5} = :backwater_client.call(:example2, :/, [3, 2])
</pre>


<h3><a name="Example_3_-_Exposure_of_a_module_using_custom_attributes_(Erlang)">Example 3 - Exposure of a module using custom attributes (Erlang)</a></h3>

<h4><a name="3.1._Add_backwater_dependency_to_rebar3">3.1. Add backwater dependency to rebar3</a></h4>
<pre lang="erlang">
% rebar.config
{deps, [{backwater, "1.0.0"}]}.
</pre>

<h4><a name="3.2._Add_custom_attributes_to_module_within_your_application">3.2. Add custom attributes to module within your application</a></h4>
<pre lang="erlang">
% foobar.erl
-module(foobar)
-export([hello/0, increment/1]).

% The custom export attribute
-backwater_export({hello,0}).
-backwater_export({increment,1}).

hello() -&gt; world.

increment(Number) -&gt; Number + 3.
</pre>

<h4><a name="3.3._Generate_unique_secret">3.3. Generate unique secret</a></h4>
<pre lang="erlang">
Secret = crypto:strong_rand_bytes(32).
</pre>

<h4><a name="3.4._Start_server">3.4. Start server</a></h4>
<pre lang="erlang">
% Place this where appropriate e.g. on application start/2 callback
{ok, _Pid} =
    backwater_server:start_clear(
        example3,
        #{ secret =&gt; Secret,
           exposed_modules =&gt; [foobar] }, % function exposure is determined by attributes
        [{port, 8080}],
        #{}).
</pre>

<h4><a name="3.5._Start_client">3.5. Start client</a></h4>
<pre lang="erlang">
% Place this where appropriate e.g. on application start/2 callback
ok = backwater_client:start(
        example3,
        #{ endpoint =&gt; &lt;&lt;"http://127.0.0.1:8080/"&gt;&gt;,
           secret =&gt; Secret }).
</pre>

<h4><a name="3.6._Execute_remote_calls">3.6. Execute remote calls</a></h4>
<pre lang="erlang">
{ok, world} = backwater_client:call(foobar, hello, []),
{ok, 43} = backwater_client:call(foobar, increment, [42]).
</pre>

<hr>
<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Aug 21 2017, 01:31:44.</i></p>
</body>
</html>
